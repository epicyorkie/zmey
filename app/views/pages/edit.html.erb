<%= page_header 'Edit Page' %>

<ul class="breadcrumb">
  <li>
    <%= link_to 'Pages', pages_path %>
    <span class="divider">/</span>
  </li>
  <li class="active">
    Edit Page
  </li>
</ul>

<div class="row">
  <div class="span5">
    <%= render 'form', submit_label: 'Save' %>
  </div>
  <div class="span7">

    <h2>Products</h2>
    <% if @page.product_placements.empty? %>
    <p>There are no products on this page.</p>
    <% else %>
    <table class="table table-bordered">
      <% @page.product_placements.each do |pp| %>
      <tr>
        <td>
          <% if pp.product.in_stock? %>
          <%= pp.product.name %>
          <% else %>
          <span class="muted"><%= pp.product.name %></span>
          <% end %>
        </td>
        <td>
          <%= edit_button(pp.product) %>
          <%= link_to "Remove", product_placement_path(pp), class: 'btn btn-mini', title: 'Remove from page', method: :delete %>
          <% unless pp.first? %>
          <%= link_to '<i class="icon-arrow-up"></i>'.html_safe, { controller: 'product_placements', action: 'move_up', id: pp.id }, class: 'btn btn-mini', method: :post %>
          <% end %>
          <% unless pp.last? %>
          <%= link_to '<i class="icon-arrow-down"></i>'.html_safe, { controller: 'product_placements', action: 'move_down', id: pp.id }, class: 'btn btn-mini', method: :post %>
          <% end %>
        </td>
      </tr>
      <% end %>
    </table>
    <% end %>

    <div class="well">
      <% unless Product.count == 0 -%>
      <%= form_for ProductPlacement.new do |form| %>
      <input type="hidden" name="product_placement[page_id]" value="<%= @page.id %>">
      <%= form.collection_select :product_id, @w.products, :id, :name_with_sku %>
      <%= submit_tag 'Add Product', class: 'btn' %>
      <% end %>
      <% end -%>
    </div>
    <%= delete_button(@page) %>

  </div>
</div>