<div class="product<%= ' full_product' if full %>" id="product_<%= product.id %>">
  <% unless full -%>
  <h2><%= link_to product.name, product_path(product) %></h2>
  <% end -%>
  <% unless product.image.nil? -%>
  <p class="product_image">
    <% if full %>
    <%= image_tag(product.image.url(@w.product_image_size), :alt => product.image.name) %>
    <% else %>
    <%= link_to image_tag(product.image.url(@w.product_thumbnail_size), :alt => product.image.name), product_path(product) %>
    <% end %>
  </p>
  <% end -%>
  <div class="product_detail">
    <%= form_tag :controller => 'basket', :action => 'add' do |form| %>
    <input type="hidden" name="product_id" value="<%= product.id %>" />
    <% if defined? page -%>
    <input type="hidden" name="page_id" value="<%= page.id %>" />
    <% end -%>
    <div class="product_description">
      <% if full and !product.full_detail.empty? -%>
      <%= raw textilize(product.full_detail) %>
      <% else -%>
      <%= raw textilize(product.description) %>
      <% end -%>
    </div>
    <% unless product.features.empty? %>
    <div class="product_features">
      <% product.features.each do |feature| -%>
      <p class="<%= feature.class_name %>">
        <%= h feature.name %>:
        <% case feature.ui_type
        when Feature::TEXT_FIELD %>
          <input type="text" name="feature[<%= feature.id %>]" />
        <% when Feature::DROP_DOWN %>
          <select name="feature[<%= feature.id %>]">
            <option value="">-- Choose --</option>
            <% feature.choices.each do |choice| %>
            <option value="<%= choice.id %>"><%= choice.name %></option>
            <% end %>
          </select>
        <% end %>
        <% if admin? -%>
        <%= link_to 'Edit feature', edit_feature_path(feature.id) %>
        <% end -%>
      </p>
      <% end -%>
    </div>
    <% end -%>
    <p class="product_price">
      <%= I18n.t('price') %>:
      <%= formatted_price(product.price_with_tax(1, @inc_tax)) %><%= tax_explanation(product) %>
    </p>
    <span class="quantity"><label><%= I18n.t('quantity') %>: <input type="text" name="quantity" value="1" /></label></span>
    <span class="add_to_basket"><%= submit_tag I18n.t('add_to_cart') %></span>
    <% quantity_prices_table(product) %>
    <% end %>
  </div>
  <% if admin_or_manager? -%>
  <div class="product_admin_controls">
  <p>
    <%= link_to 'Edit ' + product.name, edit_product_path(product) %><br />
    <%= link_to 'Add feature to ' + product.name, new_feature_path(:product_id => product.id) %>
  </p>
  <% if defined? placement -%>
  <%= button_to "Remove from page", product_placement_path(placement), :method => :delete %>
  <% unless placement.first? %>
  <%= button_to "Move Up", :controller => 'product_placements', :action => 'move_up', :id => placement.id %>
  <% end %>
  <% unless placement.last? %>
  <%= button_to "Move Down", :controller => 'product_placements', :action => 'move_down', :id => placement.id %>
  <% end %>
  <% end -%>
  </div>
  <% end -%>
</div>
